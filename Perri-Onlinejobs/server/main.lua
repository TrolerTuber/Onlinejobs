
local connectedPlayers = {}



ESX.RegisterServerCallback('OnlineJobs:getConnectedPlayers', function(source, cb)
cb(connectedPlayers)
end)

AddEventHandler('esx:setJob', function(playerId, job, lastJob)
connectedPlayers[playerId].job = job.name

TriggerClientEvent('OnlineJobs:updateConnectedPlayers', -1, connectedPlayers)
end)

AddEventHandler('esx:playerLoaded', function(playerId, xPlayer)
AddPlayerToScoreboard(xPlayer, true)
end)

AddEventHandler('esx:playerDropped', function(playerId)
connectedPlayers[playerId] = nil

TriggerClientEvent('OnlineJobs:updateConnectedPlayers', -1, connectedPlayers)
end)

AddEventHandler('onResourceStart', function(resource)
if resource == GetCurrentResourceName() then
Citizen.CreateThread(function()
Citizen.Wait(1000)
AddPlayersToScoreboard()
end)
end
end)

function AddPlayerToScoreboard(xPlayer, update)
local playerId = xPlayer.source

connectedPlayers[playerId] = {}
connectedPlayers[playerId].id = playerId
connectedPlayers[playerId].job = xPlayer.job.name

if update then
	TriggerClientEvent('OnlineJobs:updateConnectedPlayers', -1, connectedPlayers)
end

if xPlayer.getGroup() == 'user' then
	Citizen.CreateThread(function()
		Citizen.Wait(3000)
		TriggerClientEvent('OnlineJobs:toggleID', playerId, false)
	end)
end
end

function AddPlayersToScoreboard()
local players = ESX.GetPlayers()

for i=1, #players, 1 do
	local xPlayer = ESX.GetPlayerFromId(players[i])
	AddPlayerToScoreboard(xPlayer, false)
end

TriggerClientEvent('OnlineJobs:updateConnectedPlayers', -1, connectedPlayers)
end